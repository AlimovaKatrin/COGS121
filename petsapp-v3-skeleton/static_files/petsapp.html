<!--

Web frontend for petsapp

COGS121 by Philip Guo
https://github.com/pgbovine/COGS121

Start ../server.js and then visit this URL to view this webpage:

http://localhost:3000/petsapp.html

-->

<html>
<head>
<title>PetsApp</title>

<!-- put your Firebase initialization code up here before all other JavaScript code -->

<!--
NOTE: EVEN IF THE INSTRUCTIONS MENTION AN UPDATED VERSION OF FIREBASE IN THE
FUTURE, MAKE SURE TO IMPORT firebase.js AND NOT SOMETHING LIKE firebase-app.js
-->


<script src="jquery-3.3.1.min.js"></script>

<script type="text/javascript">

// jQuery convention for running when the document has been fully loaded:
$(document).ready(() => {
  const database = firebase.database();

  $('#resetButton').click(() => {
    console.log('Resetting the database');

    /* remember the fake JavaScript object database from PetsApp v1?

    const fakeDatabase = {
      'Philip': {job: 'professor', pet: 'cat.jpg'},
      'John': {job: 'student',   pet: 'dog.jpg'},
      'Carol': {job: 'engineer',  pet: 'bear.jpg'}
    };
    */
  });

  $('#readButton').click(() => {
    const requestURL = 'users/' + $('#nameBox').val();
    console.log('making ajax request to:', requestURL);

    // From: http://learn.jquery.com/ajax/jquery-ajax-methods/
    // Using the core $.ajax() method since it's the most flexible.
    // ($.get() and $.getJSON() are nicer convenience functions)
    $.ajax({
      // all URLs are relative to http://localhost:3000/
      url: requestURL,
      type: 'GET',
      dataType : 'json', // this URL returns data in JSON format
      success: (data) => {
        console.log('You received some data!', data);

        if (data.job && data.pet) {
          $('#status').html('Successfully fetched data at URL: ' + requestURL);
          $('#jobDiv').html('My job is ' + data.job);
          $('#petImage').attr('src', data.pet).attr('width', '300px');
        } else {
          $('#status').html('Error: could not find user at URL: ' + requestURL);
          // clear the display
          $('#jobDiv').html('');
          $('#petImage').attr('src', '').attr('width', '0px');
        }
      },
    });
  });

  $('#allUsersButton').click(() => {
    $.ajax({
      url: 'users',
      type: 'GET',
      dataType : 'json',
      success: (data) => {
        console.log('You received some data!', data);
        $('#status').html('All users: ' + data);
      },
    });
  });

  $('#insertButton').click(() => {
    $.ajax({
      // all URLs are relative to http://localhost:3000/
      url: 'users',
      type: 'POST', // <-- this is POST, not GET
      data: {
              name: $('#insertNameBox').val(),
              job: $('#insertJobBox').val(),
              pet: $('#insertPetBox').val()
            },
      success: (data) => {
        $('#status').html(data.message);
      }
    });
  });

  // define a generic Ajax error handler:
  // http://api.jquery.com/ajaxerror/
  $(document).ajaxError(() => {
    $('#status').html('Error: unknown ajaxError!');
  });
});
</script>

</head>
<body>
  <h1>Welcome to PetsApp!</h1>

  <button id="resetButton">Reset database</button>
  <hr/>

  Name: <input id="nameBox" type="text" size="20"/>
  <button id="readButton">Get profile</button>
  <button id="allUsersButton">Get all usernames</button>

  <div id="jobDiv"></div>
  <img id="petImage"></img>

  <hr/>
  Name: <input id="insertNameBox" type="text" size="20"/>
  Job: <input id="insertJobBox" type="text" size="20"/>
  Pet: <input id="insertPetBox" type="text" size="20"/>
  <button id="insertButton">Insert into database</button>

  <hr/>
  Name: <input id="deleteNameBox" type="text" size="20"/>
  <button id="deleteButton">Delete from database</button>

  <hr/>
  <div id="status"></div>
</body>
</html>
